local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local specialPlayers = {
    ["COMBO_WICK"] = true, -- Specific player 1 (Roblox username)
    ["yejduhvttjdruf"] = true, -- Specific player 2 (Roblox username)
}

local keyTimeout = 60 -- Time limit for changing key in seconds (1 minute)
local key, lastKeyChangeTime

-- Check if we have a saved key from the previous session (if executor supports persistence)
if _G.savedKey and tick() - _G.savedKeyTime < keyTimeout then
    key = _G.savedKey
    lastKeyChangeTime = _G.savedKeyTime
else
    key = tostring(math.random(100000, 999999))  -- Generate a new key if no saved key or timeout has passed
    lastKeyChangeTime = tick()
end

-- Function to generate a random key
local function generateRandomKey()
    return tostring(math.random(100000, 999999))  -- Random key generation
end

-- Function to check if a player is one of the special players
local function isSpecialPlayer(playerName)
    return specialPlayers[playerName] ~= nil
end

-- Function to update the key after the timeout
local function checkKeyChange()
    local currentTime = tick()
    if currentTime - lastKeyChangeTime >= keyTimeout then
        -- If the timeout has passed, generate a new key for everyone
        key = generateRandomKey()
        lastKeyChangeTime = currentTime  -- Update the time of the last key change

        -- Save the new key and timestamp so it persists across reboots/joins
        _G.savedKey = key
        _G.savedKeyTime = lastKeyChangeTime
    end
end

local scriptURLs = {
    [18209375211] = "https://raw.githubusercontent.com/checkurasshole/Script/refs/heads/main/FireTouchIntrest%20Universal",  -- Game 1
    -- ... Add other game URLs here ...
}

local defaultScriptURL = "https://raw.githubusercontent.com/checkurasshole/Script/refs/heads/main/Default"
local gameId = game.PlaceId
local scriptToLoad = scriptURLs[gameId] or defaultScriptURL

-- GUI Setup
local Window = Rayfield:CreateWindow({
    Name = "ComboChronicle Vault | Game Loader",
    LoadingTitle = "Loading ComboChronicle Vault ‚ùñ",
    LoadingSubtitle = "By COMBO_WICK | Bang.E.Line",
    Theme = "Ocean"
})

-- Key and Credits Tab
local KeyTab = Window:CreateTab("Key & Credits", 4483362458)

KeyTab:CreateInput({
    Name = "Enter Key",
    PlaceholderText = "Type the key here...",
    RemoveTextAfterFocusLost = false,
    Callback = function(input)
        -- Check if the entered key matches the current key and if the player is special
        if input == key or isSpecialPlayer(game.Players.LocalPlayer.Name) then
            Rayfield:Destroy() -- Close the GUI
            print("Loading script for game ID: " .. tostring(gameId))

            -- Example of loading scripts based on game ID
            local success, err = pcall(function()
                loadstring(game:HttpGet(scriptToLoad))()
            end)
            if not success then warn("Error loading script: " .. err) end
        else
            Rayfield:Notify({
                Title = "‚ùå Incorrect Key",
                Content = "Join the Discord to get the correct key!",
                Duration = 5,
                Image = 4483362458
            })
        end
    end
})

-- Special players can view and copy the current key
if isSpecialPlayer(game.Players.LocalPlayer.Name) then
    KeyTab:CreateButton({
        Name = "üìã Copy Current Key",
        Callback = function()
            setclipboard(key)  -- Copies the current key to the clipboard
            Rayfield:Notify({
                Title = "‚úÖ Key Copied",
                Content = "The current key has been copied to your clipboard!",
                Duration = 5,
                Image = 4483362458
            })
        end,
    })
end

KeyTab:CreateButton({
    Name = "üìã Copy Discord Link/YouTube",
    Callback = function()
        local links = "Discord: discord.com/invite/mwTHaCKzhw\nYouTube: https://www.youtube.com/@COMBO_WICK"
        setclipboard(links)
        Rayfield:Notify({
            Title = "‚úÖ Links Copied",
            Content = "Discord and YouTube links have been copied to your clipboard!",
            Duration = 5,
            Image = 4483362458
        })
    end,
})

-- Key refresh every second
game:GetService("RunService").Heartbeat:Connect(function()
    checkKeyChange()  -- Keep checking if the key needs to be updated
end)
